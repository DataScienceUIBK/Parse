<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <title>فرم ارزیابی پرسش‌ و پاسخ (Persian Question Answering Benchmark)</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    :root{
      --bg:#0b0f1a; --panel:#11182a; --muted:#aab3c7; --text:#e9f1ff; --soft:#0e1430; --line:#1f2b4a; --accent:#4aa4ff; --chip:#0b1022; --warn:#ff7676;
    }
    *{box-sizing:border-box;font-family:system-ui,-apple-system,Segoe UI,Roboto,"Vazirmatn","Noto Naskh Arabic",Tahoma}
    body{margin:0;background:linear-gradient(180deg,#0b0f1a 0%,#0c1124 35%,#0b0f1a 100%);color:var(--text)}
    .wrap{max-width:1100px;margin:20px auto;padding:16px}
    header{display:flex;gap:10px;align-items:center;justify-content:space-between;flex-wrap:wrap}
    .pill{display:inline-block;padding:6px 10px;border-radius:999px;background:var(--chip);border:1px solid #213054;color:#cfe}
    .toolbar{display:flex;gap:10px;align-items:center;flex-wrap:wrap;margin:10px 0}
    select, input[type=text]{background:#0d1530;color:var(--text);border:1px solid #23345a;border-radius:10px;padding:8px 10px}
    button{background:#1a2950;color:#eaf2ff;border:1px solid #284072;border-radius:10px;padding:8px 12px;cursor:pointer}
    button.primary{background:var(--accent);color:#04233e;border-color:#2f7dd3}
    button.ghost{background:transparent}
    .muted{color:var(--muted)}

    /* Cards */
    .cards{display:grid;gap:12px}
    .card{background:var(--panel);border:1px solid var(--line);border-radius:14px;padding:14px;box-shadow:0 10px 25px rgba(0,0,0,.35)}
    .grid{display:grid;gap:14px;grid-template-columns:1fr 320px}
    @media (max-width:900px){ .grid{grid-template-columns:1fr} }
    .qbox{background:var(--soft);border:1px solid #1a2544;border-radius:10px;padding:10px;white-space:pre-wrap}
    .meta{display:flex;gap:8px;flex-wrap:wrap;margin-bottom:6px}
    .meta .chip{background:var(--chip);border:1px solid #1f2b4a;border-radius:999px;padding:4px 8px;color:#cfe;font-size:.88rem}
    .options{margin:6px 0 0 0;padding:0;list-style:none;counter-reset:num}
    .options li{counter-increment:num;display:flex;gap:8px;align-items:flex-start;padding:6px 8px;border:1px dashed #20305a;border-radius:10px;background:#0b1126;margin-bottom:6px}
    .options li .num{font-weight:700;color:#bfe;min-width:28px;text-align:center}
    .answer{margin-top:8px}
    .answer .tag{display:inline-block;background:#0d1936;border:1px solid #243462;color:#d7e7ff;padding:4px 8px;border-radius:8px}

    /* Scales */
    .scales{display:grid;gap:10px}
    .scale{background:#0c1430;border:1px solid #223461;border-radius:12px;padding:10px}
    .scale-title{font-weight:700;margin-bottom:6px}
    .scale .opts{display:flex;gap:6px;flex-wrap:nowrap}
    .radio-pill{position:relative}
    .radio-pill input{appearance:none;-webkit-appearance:none;width:36px;height:36px;border:1px solid #314b84;border-radius:10px;background:#0a1226;color:#dff;display:grid;place-items:center;cursor:pointer}
    .radio-pill input:focus{outline:2px solid #4777cf}
    .radio-pill input::after{content:attr(data-val);font-weight:700}
    .radio-pill input:checked{background:linear-gradient(180deg,#58b1ff,#6fe2ff);color:#07223b;border-color:#4aa4ff}

    .progress{height:10px;background:#0a1328;border:1px solid #1c2a4e;border-radius:999px;overflow:hidden}
    .bar{height:100%;width:0%;background:linear-gradient(90deg,#2bc0ff,#58ffb5)}

    /* --- validation hint --- */
    input.error { border-color: var(--warn) !important; box-shadow: 0 0 0 2px rgba(255,118,118,.15); }
    .hint { color: var(--warn); margin-inline-start: 8px; font-size: .92rem; }

    /* --- Instruction modal --- */
    .modal-backdrop{
      position:fixed; inset:0; background:rgba(0,0,0,.6);
      display:none; z-index:1000;
    }
    .modal{
      position:fixed; inset:40px 20px; background:var(--panel);
      border:1px solid var(--line); border-radius:16px; z-index:1001;
      display:none; box-shadow:0 18px 50px rgba(0,0,0,.5);
      overflow:hidden;
    }
    .modal header{
      display:flex; justify-content:space-between; align-items:center;
      padding:12px 16px; border-bottom:1px solid var(--line); background:#0f1730;
    }
    .modal header h2{ margin:0; font-size:1.1rem }
    .modal .close-x{ background:transparent; border:1px solid #2a3e6a; border-radius:10px; color:#dfe9ff; padding:6px 10px; cursor:pointer }
    .modal .body{
      padding:16px; height:calc(100% - 58px); overflow:auto; line-height:1.8;
    }
    .modal .body h3{ margin:14px 0 6px; font-size:1rem }
    .modal .callout{
      background:#0b1126; border:1px solid #223461; border-radius:12px; padding:10px 12px; margin:10px 0;
    }
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <div>
        <h1 style="margin:0 0 6px">Persian Question Answering Benchmark</h1>
        <div class="muted">فرم ارزیابی پرسش‌ و پاسخ</div>
      </div>
      <span class="pill"><button id="instrBtn" class="ghost">راهنما / دستورالعمل</button></span>
    </header>

    <!-- Toolbar 1 -->
    <div class="toolbar">
      <div>شناسهٔ ارزیاب:
        <input id="annotator" placeholder="مثلاً A12" />
        <span id="annotHint" class="hint" style="display:none">لطفاً شناسهٔ ارزیاب را وارد کنید.</span>
      </div>
      <div>نام ارزیاب:
        <input id="annotatorName" placeholder="نام و نام‌خانوادگی" />
      </div>
    </div>

    <!-- Toolbar 2 -->
    <div class="toolbar">
      <button id="saveProgBtn" class="ghost">ذخیرهٔ پیشرفت (Backup)</button>
      <button id="importProgBtn" class="ghost">بارگذاری پیشرفت از فایل(Load/Import Backup)</button>
      <input type="file" id="importProgFile" accept="application/json,.json" style="display:none" />
      <button id="autoBackupBtn" class="ghost">پشتیبان‌گیری خودکار به فایل(Auto Save)</button>
      <span id="autoBackupStatus" class="muted"></span>

      <button id="exportBtn" class="primary">خروجی JSON</button>
      <span id="restoreNote" class="muted"></span>
    </div>

    <!-- Toolbar 3 -->
    <div class="toolbar">
      <div class="muted">اندازه صفحه:
        <select id="pageSizeSel">
          <option>10</option>
          <option selected>20</option>
          <option>30</option>
          <option>50</option>
        </select>
        <button id="prevPage" class="ghost">صفحه قبل</button>
        <button id="nextPage" class="ghost">صفحه بعد</button>
        <span class="muted">— <span id="count">—</span></span>
      </div>
    </div>

    <div class="progress" style="margin:8px 0 12px"><div id="progBar" class="bar"></div></div>

    <div id="cards" class="cards"></div>
  </div>

  <!-- Paste your dataset JSON array inside the script below, replacing [] -->
  <script id="dataset" type="application/json"> [
    {
    "id": "factoid_reasoning_nonanswerable_355",
    "question": "چند درصد از مقالات دانشگاهی رشته علوم اجتماعی تا سال ۱۳۹۰ از مفاهیم نشانه‌شناسی ارتباطات بیولوژیکی الهام گرفته‌اند؟",
    "answer": null,
    "difficulty": "Medium"
  },
  {
    "id": "boolean_reasoning_negation_562",
    "question": "اگر هیچ بازیکنی بدون رعایت ترکیب تیم مجاز به بازی نباشد، آیا بازیکن خارج از ترکیب بازی کرده؟",
    "answer": false,
    "difficulty": "Hard"
  },
  {
    "id": "multichoice_reasoning_single_280",
    "question": "اگر a = ۴ و b = ۵، مقدار ab − b² چیست؟",
    "options": [
      "-۵",
      "۰",
      "هیچ‌کدام",
      "-۹"
    ],
    "answer": "-۵",
    "difficulty": "Medium"
  }]</script>

  <!-- Instruction Dialog -->
  <div id="dlgBackdrop" class="modal-backdrop"></div>
  <div id="dlg" class="modal" role="dialog" aria-modal="true" aria-labelledby="dlgTitle">
    <header>
      <h2 id="dlgTitle">راهنمای ارزیابی پرسش‌ و پاسخ</h2>
      <button id="dlgClose" class="close-x">✕</button>
    </header>
    <div class="body">
      <div class="callout">
        <strong>الزامی:</strong> پیش از شروع، <u>شناسهٔ ارزیاب</u> و <u>نام ارزیاب</u> را وارد کنید. اگر شناسه یا نام خالی باشد، دکمهٔ «خروجی JSON» اجازهٔ خروجی نمی‌دهد.
      </div>

      <h3>هدف و محدوده</h3>
      این صفحه برای ارزیابی مجموعه‌ای از پرسش‌ها/پاسخ‌هاست.لطفا هر مورد را از نظر <strong>ابهام</strong>، <strong>خوانایی</strong> و <strong>درستی</strong> با امتیاز ۱ تا ۵ نمره دهید.

      <h3>تعریف نمره‌ها</h3>
      <ul>
        <li><strong>ابهام سوال:</strong> ۱ = بسیار مبهم، ۵ = بسیار روشن.</li>
        <li><strong>خوانایی پاسخ و سوال:</strong> ۱ = دشوار برای خواندن، ۵ = روان و قابل فهم.</li>
        <li><strong>درستی پاسخ به سوال:</strong> ۱ = نادرست/بی‌ربط، ۵ = کاملاً درست و مرتبط با سؤال.</li>
      </ul>

      <h3>روند کار (Workflow)</h3>
      <ol>
        <li>پرکردن شناسه و نام ارزیاب در نوار بالا.</li>
        <li>مرور کارت‌ها؛ اگر گزینه‌ها وجود داشته باشد، به‌صورت شماره‌دار نمایش داده می‌شوند.</li>
        <li>ثبت سه نمرهٔ هر کارت با دکمه‌های ۱ تا ۵.</li>
        <li>پایش نوار پیشرفت بالای کارت‌ها تا تکمیل کل مجموعه.</li>
      </ol>

      <h3>ذخیره و بازیابی</h3>
      <ul>
        <li>پیشرفت‌ها به‌صورت دوره‌ای روی مرورگر شما ذخیره می‌شود.</li>
        <li>اگر می‌خواهید فعلاً متوقف شوید، <strong>حتماً</strong> از دکمهٔ «ذخیرهٔ پیشرفت (Backup)» استفاده کنید و فایل JSON را نگه دارید.</li>
        <li>برای ادامه، «بارگذاری پیشرفت از فایل(Load/Import Backup)» را بزنید و همان فایل JSON را انتخاب کنید.</li>
        <li>در مرورگرهای پشتیبانی‌شده می‌توانید «پشتیبان‌گیری خودکار به فایل(Auto Save)» را فعال کنید.</li>
      </ul>

      <h3>ناوبری و اندازه صفحه</h3>
      با دکمه‌های «صفحه قبل/بعد» جابه‌جا شوید و از منوی «اندازه صفحه» تعداد کارت‌های هر صفحه را تغییر دهید.

      <h3>خروجی نهایی و ارسال</h3>
      <ol>
        <li>پس از اتمام ارزیابی، دکمهٔ <strong>«خروجی JSON»</strong> را بزنید.</li>
        <li>خروجی شامل: شناسه/نام ارزیاب، زمان ارسال، شناسهٔ آیتم، دشواری، سؤال/گزینه‌ها/پاسخ (در صورت وجود) و ۳ نمرهٔ شماست.</li>
        <li>فایل را به ایمیل(seyed.mousavinasab@student.uibk.ac.at) ارسال کنید. <em>خروجی JSON الزامی است.</em></li>
      </ol>

      <h3>رفع اشکال متداول</h3>
      <ul>
        <li>اگر صفحه دیر بارگذاری شد، کمی صبر کنید یا اندازه صفحه را کاهش دهید.</li>
        <li>اگر دکمهٔ خروجی کار نمی‌کند، بررسی کنید <strong>شناسه و نام ارزیاب</strong> خالی نباشد.</li>
        <li>اگر پشتیبان‌گیری خودکار غیرفعال است، مرورگر شما File System Access API را پشتیبانی نمی‌کند؛ از «ذخیرهٔ پیشرفت (Backup)» استفاده کنید.</li>
      </ul>

      <div class="callout">
        یادآوری: قبل از بستن مرورگر یا خاموش کردن سیستم، <strong>حتماً</strong> ذخیره کنید.
      </div>
    </div>
  </div>

  <script>
    const data = JSON.parse(document.getElementById('dataset').textContent);

    const annotEl = document.getElementById('annotator');
    const annotNameEl = document.getElementById('annotatorName');
    const annotHint = document.getElementById('annotHint');

    const cards = document.getElementById('cards');
    const progBar = document.getElementById('progBar');

    let ratings = {}; // { id: {ambiguity, readability, correctness} }
    let page=1, pageSize=20;
    let fileHandle = null; // for auto-backup to a chosen file (Chrome/Edge)
    let writeTimer = null;

    // dataset fingerprint
    const idsStr = data.map(it=>it.id||'').join('|');
    let _h=0; for (let i=0;i<idsStr.length;i++){ _h=((_h<<5)-_h)+idsStr.charCodeAt(i); _h|=0; }
    const STORAGE_PREFIX = 'qa-fa-cards-v1:';
    const STORAGE_KEY = STORAGE_PREFIX + Math.abs(_h) + ':ratings';
    const STORAGE_ANN = STORAGE_PREFIX + Math.abs(_h) + ':annotator';
    const STORAGE_ANN_NAME = STORAGE_PREFIX + Math.abs(_h) + ':annotator_name';

    function slug(s){return String(s||'').replace(/[^\w\-]+/g,'_');}
    function fmtAnswer(a){
      if(a===null||a===undefined) return 'null';
      if(Array.isArray(a)) return a.join('، ');
      if(typeof a==='boolean') return a? 'true':'false';
      return String(a);
    }

    function makeScale(id, field, title){
      const box = document.createElement('div'); box.className='scale';
      const h = document.createElement('div'); h.className='scale-title'; h.textContent = title; box.append(h);
      const opts = document.createElement('div'); opts.className='opts'; box.append(opts);
      const name = field+'-'+slug(id);
      const preset = ratings[id]?.[field] ?? null;
      for(let v=1; v<=5; v++){
        const wrap = document.createElement('label'); wrap.className='radio-pill';
        const inp = document.createElement('input'); inp.type='radio'; inp.name=name; inp.value=String(v); inp.setAttribute('data-val', String(v));
        if(preset===v) inp.checked = true;
        inp.addEventListener('change', ()=>{
          ratings[id] = ratings[id] || {}; ratings[id][field] = Number(inp.value); saveProgress(); updateProgress();
        });
        wrap.append(inp); opts.append(wrap);
      }
      return box;
    }

    function render(){
      cards.innerHTML='';
      const frag = document.createDocumentFragment();
      const start=(page-1)*pageSize, end=Math.min(start+pageSize,data.length);

      data.slice(start,end).forEach(it=>{
        const card = document.createElement('div'); card.className='card';
        const grid = document.createElement('div'); grid.className='grid'; card.append(grid);

        // LEFT: question + options + answer
        const left = document.createElement('div');
        const meta = document.createElement('div'); meta.className='meta';
        left.append(meta);

        const q = document.createElement('div'); q.className='qbox'; q.textContent = it.question || ''; left.append(q);

        if(Array.isArray(it.options) && it.options.length){
          const ul = document.createElement('ol'); ul.className='options';
          it.options.forEach((o,i)=>{
            const li = document.createElement('li');
            const num = document.createElement('span'); num.className='num'; num.textContent = (i+1)+')';
            const txt = document.createElement('span'); txt.textContent = o;
            li.append(num, txt); ul.append(li);
          });
          left.append(ul);
        }

        const ans = document.createElement('div'); ans.className='answer';
        const tag = document.createElement('span'); tag.className='tag'; tag.textContent = 'پاسخ: '+ fmtAnswer(it.answer);
        ans.append(tag); left.append(ans);

        // RIGHT: 3 scales
        const right = document.createElement('div'); right.className='scales';
        right.append(
          makeScale(it.id, 'ambiguity', 'ابهام (۱=کم، ۵=زیادِ وضوح)'),
          makeScale(it.id, 'readability', 'خوانایی (۱=ضعیف، ۵=عالی)'),
          makeScale(it.id, 'correctness', 'درستی (۱=نادرست، ۵=کاملاً درست)')
        );

        grid.append(left, right);
        frag.append(card);
      });

      cards.append(frag);
      const total = data.length;
      const startIdx = total ? (page-1)*pageSize+1 : 0;
      const endIdx = total ? Math.min((page-1)*pageSize+pageSize, total) : 0;
      document.getElementById('count').textContent = `${total} (نمایش ${startIdx}–${endIdx})`;
      updateProgress();
    }

    function updateProgress(){
      const total = data.length;
      let filled = 0;
      for(const it of data){
        const r = ratings[it.id];
        if(r && r.ambiguity && r.readability && r.correctness) filled++;
      }
      const pct = total? Math.round((filled/total)*100) : 0;
      progBar.style.width = pct + '%';
    }

    function saveProgress(){
      try{
        localStorage.setItem(STORAGE_KEY, JSON.stringify(ratings));
        localStorage.setItem(STORAGE_ANN, annotEl.value.trim()||'');
        localStorage.setItem(STORAGE_ANN_NAME, annotNameEl.value.trim()||'');
      }catch(e){}
      scheduleAutoBackup();
    }

    function loadProgress(){
      try{
        const r = localStorage.getItem(STORAGE_KEY); if(r) ratings = JSON.parse(r)||{};
        const a = localStorage.getItem(STORAGE_ANN); if(a) annotEl.value=a;
        const n = localStorage.getItem(STORAGE_ANN_NAME); if(n) annotNameEl.value=n;
        const rn=document.getElementById('restoreNote');
        if(r || a || n){ if(rn) rn.textContent='— پیشرفت قبلی بازیابی شد'; }
      }catch(e){ ratings={}; }
    }

    // ---- Validation helpers ----
    const REQUIRE_NAME = true; // نام ارزیاب الزامی است
    function showAnnotHint(show, msg){
      annotHint.textContent = msg || 'لطفاً شناسهٔ ارزیاب را وارد کنید.';
      annotHint.style.display = show? 'inline' : 'none';
      annotEl.classList.toggle('error', !!show);
    }
    function validateAnnot(){
      const id = annotEl.value.trim();
      const name = annotNameEl.value.trim();
      if(!id){
        showAnnotHint(true);
        annotEl.focus();
        return false;
      }
      if(REQUIRE_NAME && !name){
        annotHint.textContent = 'نام ارزیاب الزامی است.';
        annotHint.style.display = 'inline';
        annotNameEl.classList.add('error');
        annotNameEl.focus();
        return false;
      }
      showAnnotHint(false);
      annotEl.classList.remove('error');
      annotNameEl.classList.remove('error');
      return true;
    }

    function exportJSON(){
      if(!validateAnnot()) return;
      const annId=annotEl.value.trim();
      const annName=annotNameEl.value.trim();

      const out=data.map(it=>({
        submission_ts:new Date().toISOString(),
        annotator_id:annId,
        annotator_name:annName || null,
        id:it.id,
        difficulty:it.difficulty,
        question:it.question,
        options:Array.isArray(it.options)? it.options : undefined,
        answer:it.hasOwnProperty('answer')? it.answer : null,
        ambiguity:ratings[it.id]?.ambiguity??null,
        readability:ratings[it.id]?.readability??null,
        correctness:ratings[it.id]?.correctness??null
      }));
      const blob=new Blob([JSON.stringify(out,null,2)],{type:'application/json'});
      const a=document.createElement('a'); a.href=URL.createObjectURL(blob); a.download=`annotations_${annId}.json`; a.click();
    }

    function buildProgressPayload(){
      return {
        annotator: annotEl.value.trim()||'',
        annotator_name: annotNameEl.value.trim()||'',
        ratings, dataset_ids: data.map(x=>x.id||'')
      };
    }

    function exportProgress(){
      const payload = buildProgressPayload();
      const blob=new Blob([JSON.stringify(payload,null,2)],{type:'application/json'});
      const a=document.createElement('a'); a.href=URL.createObjectURL(blob); a.download=`progress_${payload.annotator||'NA'}.json`; a.click();
    }

    function importProgress(file){
      if(!file) return;
      file.text().then(t=>{
        try{
          const obj=JSON.parse(t);
          const same = Array.isArray(obj.dataset_ids) && obj.dataset_ids.join('|')===data.map(x=>x.id||'').join('|');
          if(!same){ alert('این فایل پیشرفت با همین مجموعهٔ داده ساخته نشده است.'); return; }
          ratings = obj.ratings||{};
          annotEl.value = obj.annotator || annotEl.value;
          if('annotator_name' in obj) annotNameEl.value = obj.annotator_name || annotNameEl.value;
          saveProgress(); render();
          const rn=document.getElementById('restoreNote'); if(rn) rn.textContent='— پیشرفت از فایل بارگذاری شد';
        }catch(e){ alert('فایل پیشرفت نامعتبر است'); }
      });
    }

    // Init
    loadProgress();
    render();
    setInterval(saveProgress, 3000);

    // Controls
    document.getElementById('exportBtn').addEventListener('click', exportJSON);
    document.getElementById('saveProgBtn').addEventListener('click', exportProgress);
    document.getElementById('importProgBtn').addEventListener('click', ()=> document.getElementById('importProgFile').click());
    document.getElementById('importProgFile').addEventListener('change', e=> importProgress(e.target.files?.[0]||null));
    document.getElementById('autoBackupBtn').addEventListener('click', enableAutoBackup);
    annotEl.addEventListener('input', ()=>{ showAnnotHint(false); saveProgress(); });
    annotNameEl.addEventListener('input', ()=>{ annotNameEl.classList.remove('error'); saveProgress(); });
    document.getElementById('prevPage').addEventListener('click', ()=>{ if(page>1){ page--; render(); window.scrollTo({top:0,behavior:'smooth'}); } });
    document.getElementById('nextPage').addEventListener('click', ()=>{ if(page*pageSize < data.length){ page++; render(); window.scrollTo({top:0,behavior:'smooth'}); } });
    document.getElementById('pageSizeSel').addEventListener('change', e=>{ pageSize=parseInt(e.target.value,10)||20; page=1; render(); window.scrollTo({top:0}); });

    // Auto-backup helpers (File System Access API)
    async function writeAutoBackup(){
      if(!fileHandle) return;
      try{
        const payload = buildProgressPayload();
        const writable = await fileHandle.createWritable();
        await writable.write(new Blob([JSON.stringify(payload, null, 2)], {type:'application/json'}));
        await writable.close();
        const s = document.getElementById('autoBackupStatus'); if(s) s.textContent = '— ذخیره شد';
      }catch(e){
        const s=document.getElementById('autoBackupStatus'); if(s) s.textContent='— خطا در ذخیره خودکار';
        console.error(e);
      }
    }
    function scheduleAutoBackup(){
      if(!fileHandle) return; // only when enabled
      clearTimeout(writeTimer);
      writeTimer = setTimeout(writeAutoBackup, 500);
    }
    async function enableAutoBackup(){
      if(!('showSaveFilePicker' in window)){
        alert('مرورگر از ذخیرهٔ خودکار به فایل پشتیبانی نمی‌کند. از دکمهٔ «ذخیرهٔ پیشرفت (Backup)» استفاده کنید.');
        return;
      }
      try{
        const suggested = `progress_${(annotEl.value.trim()||'NA')}.json`;
        fileHandle = await window.showSaveFilePicker({
          suggestedName: suggested,
          types:[{description:'JSON', accept:{'application/json':['.json']}}]
        });
        const s = document.getElementById('autoBackupStatus'); if(s) s.textContent='— خودکار فعال شد';
        await writeAutoBackup();
      }catch(e){
        if(e?.name!=='AbortError') alert('نتوانستم فایل پشتیبان را بسازم.');
      }
    }

    // --- Instruction dialog wiring ---
    const dlg = document.getElementById('dlg');
    const dlgBackdrop = document.getElementById('dlgBackdrop');
    function openDlg(){ dlg.style.display='block'; dlgBackdrop.style.display='block'; }
    function closeDlg(){ dlg.style.display='none'; dlgBackdrop.style.display='none'; }
    document.getElementById('instrBtn').addEventListener('click', openDlg);
    document.getElementById('dlgClose').addEventListener('click', closeDlg);
    dlgBackdrop.addEventListener('click', closeDlg);
    window.addEventListener('keydown', (e)=>{ if(e.key==='Escape') closeDlg(); });
  </script>
</body>
</html>
